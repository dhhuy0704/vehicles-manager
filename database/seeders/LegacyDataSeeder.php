<?php

namespace Database\Seeders;

use App\Models\Owner;
use App\Models\GasStation;
use App\Models\Vehicle;
use App\Models\User;
use App\Models\RefuelRecord;
use Illuminate\Database\Console\Seeds\WithoutModelEvents;
use Illuminate\Database\Seeder;

class LegacyDataSeeder extends Seeder
{
    use WithoutModelEvents;
    
    /**
     * Run the database seeds.
     */
    public function run(): void
    {
        $user = User::factory()->create([
            'name'     => 'Admin',
            'password' => bcrypt('123456'),
            'email'    => 'a@b.c',
        ]);

        // Find or create owner
        $owner = Owner::firstOrCreate(
            ['email' => 'info@tommydo.ca'],
            [
                'first_name' => 'Tommy',
                'last_name'  => 'Do',
                'phone'      => '4035555555',
                'gender'     => 'male'
            ]
        );

        // Create gas stations
        $gs_1 = GasStation::create([
            'name'     => 'Costco Heritage',
            'location' => '99 Heritage Gate SE, Calgary, AB T2H 3A7',
        ]);

        $gs_2 = GasStation::create([
            'name'     => 'Costco East Hill',
            'location' => '75 E Hills Blvd SE, Calgary, AB T2A 6J8',
        ]);

        $gs_3 = GasStation::create([
            'name'     => 'Coop Forest Lawn',
            'location' => '3330 17 Ave SE, Calgary, AB T2A 0P9',
        ]);

        $vehicle = Vehicle::create([
            'type'          => 'car',
            'name'          => 'My Car',
            'manufacturer'  => 'toyota',
            'model'         => 'Siena',
            'year'          => 2019,
            'fuel_capacity' => 75.0,
            'status'        => 'active',
            'note'          => 'Bought in 2024, primary vehicle.',
            'owner_id'      => $owner->id,
        ]);

        // Create refuel records with default time at 12:00 PM
        $refuelRecords = [
            ['2024-01-17 12:00:00', $gs_2->id, 100644, 65.00],
            ['2024-01-25 12:00:00', $gs_2->id, 100944, 67.39],
            ['2024-01-31 12:00:00', $gs_2->id, 101274, 52.52],
            ['2024-02-07 12:00:00', $gs_1->id, 101561, 55.82],
            ['2024-02-15 12:00:00', $gs_1->id, 101927, 70.04],
            ['2024-02-19 12:00:00', $gs_2->id, 102348, 63.01],
            ['2024-02-24 12:00:00', $gs_2->id, 102854, 76.61],
            ['2024-03-03 12:00:00', $gs_1->id, 103279, 80.78],
            ['2024-03-07 12:00:00', $gs_2->id, 103579, 66.95],
            ['2024-03-13 12:00:00', $gs_2->id, 103872, 58.10],
            ['2024-03-21 12:00:00', $gs_3->id, 104294, 80.51],
            ['2024-03-24 12:00:00', $gs_2->id, 104504, 46.03],
            ['2024-03-31 12:00:00', $gs_3->id, 104897, 80.98],
            ['2024-04-07 12:00:00', $gs_1->id, 105216, 71.43],
            ['2024-04-13 12:00:00', $gs_1->id, 105613, 84.18],
            ['2024-04-19 12:00:00', $gs_1->id, 106055, 92.61],
            ['2024-04-24 12:00:00', $gs_2->id, 106318, 50.60],
            ['2024-05-03 12:00:00', $gs_2->id, 106638, 73.77],
            ['2024-05-14 12:00:00', $gs_2->id, 107026, 97.40],
            ['2024-05-28 12:00:00', $gs_2->id, 107769, 77.71],
            ['2024-06-12 12:00:00', $gs_2->id, 108671, 81.79],
            ['2024-06-17 12:00:00', $gs_1->id, 109084, 57.07],
            ['2024-06-24 12:00:00', $gs_2->id, 109491, 80.26],
            ['2024-07-04 12:00:00', $gs_2->id, 110262, 83.55],
            ['2024-07-05 12:00:00', $gs_2->id, 110691, 63.51],
            ['2024-07-06 12:00:00', $gs_2->id, 111243, 95.50],
            ['2024-07-08 12:00:00', $gs_2->id, 111505, 61.00],
            ['2024-07-10 12:00:00', $gs_2->id, 111872, 64.06],
            ['2024-07-14 12:00:00', $gs_1->id, 112288, 72.30],
            ['2024-07-21 12:00:00', $gs_2->id, 113205, 82.00],
            ['2024-08-02 12:00:00', $gs_2->id, 113981, 89.58],
            ['2024-08-05 12:00:00', $gs_1->id, 114244, 44.52],
            ['2024-08-10 12:00:00', $gs_1->id, 114609, 64.50],
            ['2024-08-14 12:00:00', $gs_1->id, 115388, 81.23],
            ['2024-08-20 12:00:00', $gs_2->id, 115455, 67.70],
            ['2024-08-25 12:00:00', $gs_2->id, 115855, 63.90],
            ['2024-09-01 12:00:00', $gs_1->id, 116342, 76.01],
            ['2024-09-08 12:00:00', $gs_1->id, 116812, 81.57],
            ['2024-09-14 12:00:00', $gs_2->id, 117232, 71.86],
            ['2024-09-22 12:00:00', $gs_2->id, 117755, 90.27],
            ['2024-09-30 12:00:00', $gs_2->id, 118044, 69.59],
            ['2024-09-30 12:00:00', $gs_2->id, 118524, 65.00],
            ['2024-10-05 12:00:00', $gs_2->id, 118976, 71.24],
            ['2024-10-13 12:00:00', $gs_2->id, 119380, 78.78],
            ['2024-10-28 12:00:00', $gs_2->id, 120283, 79.11],
            ['2024-11-04 12:00:00', $gs_2->id, 120609, 61.22],
            ['2024-11-16 12:00:00', $gs_2->id, 120998, 85.64],
            ['2024-11-24 12:00:00', $gs_2->id, 121394, 83.70],
            ['2024-12-04 12:00:00', $gs_2->id, 121749, 81.08],
            ['2024-12-10 12:00:00', $gs_2->id, 122050, 54.04],
            ['2024-12-20 12:00:00', $gs_2->id, 122400, 89.39],
            ['2024-12-30 12:00:00', $gs_1->id, 122746, 65.13],
            ['2025-01-07 12:00:00', $gs_2->id, 123103, 79.74],
            ['2025-01-15 12:00:00', $gs_1->id, 123533, 80.00],
            ['2025-01-19 12:00:00', $gs_1->id, 123737, 50.20],
            ['2025-01-27 12:00:00', $gs_2->id, 124094, 79.65],
            ['2025-02-03 12:00:00', $gs_2->id, 124444, 76.08],
            ['2025-02-10 12:00:00', $gs_2->id, 124735, 79.02],
            ['2025-02-17 12:00:00', $gs_2->id, 124882, 48.00],
            ['2025-02-22 12:00:00', $gs_2->id, 125097, 48.40],
            ['2025-02-24 12:00:00', $gs_2->id, 125587, 69.68],
            ['2025-03-07 12:00:00', $gs_2->id, 125994, 85.85],
            ['2025-03-14 12:00:00', $gs_2->id, 126270, 56.71],
            ['2025-03-18 12:00:00', $gs_2->id, 126500, 51.00],
            ['2025-03-24 12:00:00', $gs_2->id, 126771, 56.01],
            ['2025-04-09 12:00:00', $gs_2->id, 127844, 71.97],
            ['2025-04-28 12:00:00', $gs_2->id, 128556, 62.60],
            ['2025-04-30 12:00:00', $gs_2->id, 128782, 27.78],
            ['2025-05-05 12:00:00', $gs_2->id, 129115, 51.81],
            ['2025-05-11 12:00:00', $gs_2->id, 129325, 38.52],
            ['2025-05-25 12:00:00', $gs_2->id, 130263, 77.23],
            ['2025-05-30 12:00:00', $gs_2->id, 130540, 50.70],
            ['2025-06-06 12:00:00', $gs_2->id, 131340, 70.50],
            ['2025-06-14 12:00:00', $gs_2->id, 131559, 39.18],
            ['2025-06-19 12:00:00', $gs_2->id, 131979, 83.64],
            ['2025-07-04 12:00:00', $gs_2->id, 132211, 42.94],
            ['2025-07-13 12:00:00', $gs_1->id, 133256, 56.00],
            ['2025-07-19 12:00:00', $gs_1->id, 133658, 40.50],
            ['2025-07-24 12:00:00', $gs_1->id, 134169, 72.03],
            ['2025-08-05 12:00:00', $gs_1->id, 134579, 64.08],
            ['2025-08-13 12:00:00', $gs_2->id, 134944, 62.76],
            ['2025-08-21 12:00:00', $gs_2->id, 135288, 66.00],
            ['2025-08-29 12:00:00', $gs_2->id, 135707, 71.01],
            ['2025-09-07 12:00:00', $gs_2->id, 136186, 71.80],
            ['2025-09-13 12:00:00', $gs_1->id, 136505, 54.00],
            ['2025-09-18 12:00:00', $gs_1->id, 136869, 48.43],
            ['2025-09-27 12:00:00', $gs_1->id, 137266, 63.35],
            ['2025-09-30 12:00:00', $gs_1->id, 137669, 56.05],
            ['2025-10-07 12:00:00', $gs_1->id, 138051, 59.51],
            ['2025-10-14 12:00:00', $gs_1->id, 138435, 53.52],
            ['2025-10-19 12:00:00', $gs_1->id, 138698, 45.65]
        ];

        foreach ($refuelRecords as [$date, $gasStationId, $odometer, $cost]) {
            // Assuming an average price of $1.50 per litre for historical data
            $unitPrice = 1.50;
            $litres = round($cost / $unitPrice, 2);
            
            RefuelRecord::create([
                'date'           => substr($date, 0, 10),   // Extract just the date part
                'time'           => substr($date, 11, 8),   // Extract just the time part
                'odometer'       => $odometer,
                'price_per_unit' => $unitPrice,
                'total_cost'     => $cost,
                'amount'         => $litres,
                'vehicle_id'     => $vehicle->id,
                'gas_station_id' => $gasStationId
            ]);
        }
    }
}
